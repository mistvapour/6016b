graph TB
    %% 部署架构图
    
    subgraph "负载均衡层 - 第5章"
        LB["负载均衡器<br/>Nginx<br/>SSL终端<br/>📖 5.3.1"]
    end
    
    subgraph "Web服务层 - 第5章"
        NGINX["Nginx反向代理<br/>静态文件服务<br/>API路由<br/>📖 5.3.1"]
        FRONTEND["前端服务<br/>React静态文件<br/>端口: 5173<br/>📖 5.1.2"]
    end
    
    subgraph "应用服务层 - 第5章"
        BACKEND1["后端服务实例1<br/>FastAPI + uvicorn<br/>端口: 8000<br/>📖 5.1.1"]
        BACKEND2["后端服务实例2<br/>FastAPI + uvicorn<br/>端口: 8001<br/>📖 5.1.1"]
        BACKEND3["后端服务实例3<br/>FastAPI + uvicorn<br/>端口: 8002<br/>📖 5.1.1"]
    end
    
    subgraph "微服务层 - 第4章"
        PDF_SERVICE["PDF处理服务<br/>专用PDF处理<br/>端口: 8003<br/>📖 4.3.2(1)"]
        MQTT_SERVICE["MQTT处理服务<br/>专用MQTT处理<br/>端口: 8004<br/>📖 4.3.2(2)"]
        UNIVERSAL_SERVICE["统一导入服务<br/>多格式处理<br/>端口: 8005<br/>📖 4.3.2(4)"]
    end
    
    subgraph "数据服务层 - 第4章"
        PDF_DB[("PDF服务数据库<br/>pdf_service<br/>端口: 3306<br/>📖 4.2.4")]
        SEMANTIC_DB[("语义服务数据库<br/>semantic_service<br/>端口: 3307<br/>📖 4.2.4")]
        CDM_DB[("CDM服务数据库<br/>cdm_service<br/>端口: 3308<br/>📖 4.2.3")]
        IMPORT_DB[("导入服务数据库<br/>import_service<br/>端口: 3309<br/>📖 4.2.4")]
        USER_DB[("用户服务数据库<br/>user_service<br/>端口: 3310<br/>📖 4.3.2(5)")]
        CONFIG_DB[("配置服务数据库<br/>config_service<br/>端口: 3311<br/>📖 4.3.2(5)")]
        MONITOR_DB[("监控服务数据库<br/>monitor_service<br/>端口: 3312<br/>📖 5.3.2")]
        REDIS[("Redis缓存<br/>多DB实例<br/>端口: 6379<br/>📖 4.5.1")]
    end
    
    subgraph "存储层 - 第5章"
        FILE_STORAGE["文件存储<br/>NFS/云存储<br/>PDF/YAML/JSON<br/>📖 5.1.3"]
        LOG_STORAGE["日志存储<br/>ELK Stack<br/>应用日志<br/>📖 5.4.3"]
        BACKUP_STORAGE["备份存储<br/>定期备份<br/>数据恢复<br/>📖 5.3.1"]
    end
    
    subgraph "监控层 - 第5章"
        PROMETHEUS["Prometheus<br/>指标收集<br/>端口: 9090<br/>📖 5.3.2"]
        GRAFANA["Grafana<br/>可视化监控<br/>端口: 3000<br/>📖 5.3.2"]
        ALERTMANAGER["AlertManager<br/>告警管理<br/>端口: 9093<br/>📖 5.3.2"]
    end
    
    %% 连接关系
    LB --> NGINX
    NGINX --> FRONTEND
    NGINX --> BACKEND1
    NGINX --> BACKEND2
    NGINX --> BACKEND3
    
    BACKEND1 --> PDF_SERVICE
    BACKEND2 --> MQTT_SERVICE
    BACKEND3 --> UNIVERSAL_SERVICE
    
    PDF_SERVICE --> PDF_DB
    MQTT_SERVICE --> SEMANTIC_DB
    UNIVERSAL_SERVICE --> CDM_DB
    UNIVERSAL_SERVICE --> IMPORT_DB
    
    BACKEND1 --> USER_DB
    BACKEND2 --> CONFIG_DB
    BACKEND3 --> MONITOR_DB
    
    BACKEND1 --> REDIS
    BACKEND2 --> REDIS
    BACKEND3 --> REDIS
    
    PDF_SERVICE --> FILE_STORAGE
    MQTT_SERVICE --> FILE_STORAGE
    UNIVERSAL_SERVICE --> FILE_STORAGE
    
    BACKEND1 --> LOG_STORAGE
    BACKEND2 --> LOG_STORAGE
    BACKEND3 --> LOG_STORAGE
    PDF_SERVICE --> LOG_STORAGE
    MQTT_SERVICE --> LOG_STORAGE
    UNIVERSAL_SERVICE --> LOG_STORAGE
    
    PDF_DB --> BACKUP_STORAGE
    SEMANTIC_DB --> BACKUP_STORAGE
    CDM_DB --> BACKUP_STORAGE
    IMPORT_DB --> BACKUP_STORAGE
    USER_DB --> BACKUP_STORAGE
    CONFIG_DB --> BACKUP_STORAGE
    MONITOR_DB --> BACKUP_STORAGE
    FILE_STORAGE --> BACKUP_STORAGE
    
    PROMETHEUS --> BACKEND1
    PROMETHEUS --> BACKEND2
    PROMETHEUS --> BACKEND3
    PROMETHEUS --> PDF_SERVICE
    PROMETHEUS --> MQTT_SERVICE
    PROMETHEUS --> UNIVERSAL_SERVICE
    PROMETHEUS --> PDF_DB
    PROMETHEUS --> SEMANTIC_DB
    PROMETHEUS --> CDM_DB
    PROMETHEUS --> IMPORT_DB
    PROMETHEUS --> USER_DB
    PROMETHEUS --> CONFIG_DB
    PROMETHEUS --> MONITOR_DB
    PROMETHEUS --> REDIS
    
    GRAFANA --> PROMETHEUS
    ALERTMANAGER --> PROMETHEUS
    
    %% 样式
    classDef lb fill:#e1f5fe
    classDef web fill:#f3e5f5
    classDef app fill:#e8f5e8
    classDef micro fill:#fff3e0
    classDef data fill:#fce4ec
    classDef storage fill:#f1f8e9
    classDef monitor fill:#e0f2f1
    
    class LB lb
    class NGINX,FRONTEND web
    class BACKEND1,BACKEND2,BACKEND3 app
    class PDF_SERVICE,MQTT_SERVICE,UNIVERSAL_SERVICE micro
    class PDF_DB,SEMANTIC_DB,CDM_DB,IMPORT_DB,USER_DB,CONFIG_DB,MONITOR_DB,REDIS data
    class FILE_STORAGE,LOG_STORAGE,BACKUP_STORAGE storage
    class PROMETHEUS,GRAFANA,ALERTMANAGER monitor
